<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: ws-security | WSO2Brasil]]></title>
  <link href="http://wso2brasil.com.br/blog/tags/ws-security/atom.xml" rel="self"/>
  <link href="http://wso2brasil.com.br/"/>
  <updated>2013-10-09T14:49:16-03:00</updated>
  <id>http://wso2brasil.com.br/</id>
  <author>
    <name><![CDATA[WSO2Brasil]]></name>
    <email><![CDATA[leonardo@wso2brasil.com.br]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ Segurança de informações através de filtragem de dados no WSO2 Data Services]]></title>
    <link href="http://wso2brasil.com.br/blog/2011/02/seguranca-de-informacoes-atraves-de-filtragem-de-dados-no-wso2-data-services/"/>
    <updated>2011-02-24T19:30:30-03:00</updated>
    <id>http://wso2brasil.com.br/blog/2011/02/seguranca-de-informacoes-atraves-de-filtragem-de-dados-no-wso2-data-services</id>
    <content type="html"><![CDATA[<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/cadeado.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/cadeado-300x199.jpg" alt="" /></a></p>

<p>Em alguns casos, podemos nos deparar com a necessidade de confidencializar
alguns dados no retorno de <a href="http://www.mcorp.com.br/glossario/#DataServices">Data Services</a>,
exibindo-os apenas
para determinados grupos de usuários, tanto por questão de segurança (quando
algum grupo específico não pode ter acesso a algumas informações),  quanto por
não ter a necessidade de utilizar esse retorno, para que assim não precisemos
criar dois serviços com a mesma finalidade. O WSO2 Data Services Server
oferece a possibilidade de filtrar esses dados no retorno de uma <em>query</em>,
através do <a href="http://www.mcorp.com.br/glossario/#WS-Security">WS-Security</a> (tem
como foco principal o uso de <a href="http://www.mcorp.com.br/glossario%0A/#XML-Signature">XML Signature</a> e <a href="http://www.mcorp.com.br/glossario/#XML-Encryption">XML Encryption</a>). Nesse caso irei exemplificar a seguinte situação: um serviço que
retorna dados referente aos funcionários, sendo consumido por dois
departamentos: o RH (que necessita dos dados referente aos pagamentos dos
honorários) e o setor de segurança (que utiliza apenas os dados cadastrais
para acesso dos funcionários as dependências da empresa).</p>

<p>Iremos utilizar nesse exemplo o WSO2 Data Services Server em sua versão 2.5.1
(nesse caso considerando um conhecimento básico da suíte
<a href="http://www.mcorp.com.br/glossario/#WSO2">WSO2</a>, caso contrário consulte os
<a href="http://www.mcorp.com.br/tag/wso2"><em>posts</em> relacionados ao WSO2</a>):</p>

<ul>
<li><a href="http://www.leandroprado.com.br/2010/07/criando-um-ambiente-soa-com-wso2/">Criando um ambiente SOA com WSO2</a></li>
<li><a href="http://www.leandroprado.com.br/2010/09/criando-servicos-com-o-wso2-parte-1-wso2-data-services/">Criando serviços com WSO2 Data Services</a></li>
</ul>


<p>Supondo que possuímos o banco de dados, com uma tabela simples chamada de
TB_FUNCIONARIOS, com os campos: ID, NOME E SALARIO.</p>

<h2>Etapa 1 - Criando o usuário</h2>

<p>Logado ao WSO2 Data Services Server vá em "Home > Configure > User Management > Users",
para que possamos criar novos usuários, nesse caso criaremos os
usuários "Maria" que faz parte do departamento de RH da empresa e "Joao" que
faz parte da segurança do prédio. Click em "Add User" para preenchermos os
dados do usuário que será cadastrado.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.0-add-user-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.0-add-user-wso2-300x205.jpg" alt="add user wso2" /></a></p>

<p>Após inserir os dados do usuário, clicar em "finish", repetir o procedimento
pro cadastro do outro usuário. Podemos listar os usuários criados como mostra
a imagem.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.1-list-user-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.1-list-user-wso2-300x149.jpg" alt="list user wso2" /></a></p>

<h2>Etapa 2 - Criando grupos de usuários</h2>

<p>Com nossos usuários criados, vamos gerar um grupo para vincular ao perfil do
usuário. Vá em "Home > Configure > Users and Roles > Roles", serão listados os
grupos existentes no WSO2, clique em "Add New Role" que abrirá a tela para
cadastrarmos os grupos.</p>

<p>Crie um grupo com o nome "RecursosHumanos", em seguida clique em "next",
aparecerá a tela com os flags de permissões e previlégios para os membros do
grupo. Nesse caso vamos selecionar a opção "All permissions", para que sejam
marcadas todas as opções. Enquanto estamos criando o grupo, já podemos
vincular os usuários que farão parte do mesmo, faça uma busca listando todos
os usuários e selecione o usuário "Maria" criado anteriormente, como na imagem
abaixo e finalize.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.2-select-user-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.2-select-user-wso2-300x170.jpg" alt="select user wso2" /></a></p>

<p>Agora usando o mesmo processo vamos criar o grupo "Seguranca". Observe que
quando selecionamos algum usuário criado e vinculado ao grupo, o mesmo possui
um ou vários grupos selecionados.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.3-roles-of-users-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.3-roles-of-users-wso2-300x176.jpg" alt="roles of users wso2" /></a></p>

<h2>Etapa 3 - Filtrando dados da consulta</h2>

<p>Com os usuários e grupos devidamente criados vamos finalmente ao que
interessa, filtrar os dados de acordo com o perfil de cada grupo. Considerando
que já exista um serviço "empresa", vamos criar o método
"pesquisarFuncionario" para demonstrar como filtrar os dados de retorno do
método. Nesse caso, o método nos retornará os campos "ID" e "NOME" para o
grupo Segurança, e "ID", "NOME" e "SALARIO" para o grupo RecursosHumanos.</p>

<p>Iremos em "Home > Manage > Services > List > Service Dashboard > Service
Details > Data Sources > Queries",  para inserirmos nosso novo método.
Preenchemos com o SQL, o campo de entrada, e na hora em que formos preencher o
retorno será onde a "mágica" acontecerá.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.4-edit-query-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.4-edit-query-wso2-300x176.jpg" alt="edit query wso2" /></a></p>

<p>No item "Add new output Mapping" abriremos a tela para cadastrar um novo campo
de retorno, preenchemos o tipo do campo, o nome de saída e o nome do campo no
SQL. Abaixo dessas opções temos o item "Allowed User Roles", aonde aparecerão
os grupos que criamos anteriormente, para os campos "ID E NOME" selecionaremos
ambos os grupos, no caso do campo "SALARIO" selecionaremos apenas o grupo
RecursosHumanos, com o método criado mostraremos como consumir esse método
filtrando os dados.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.5-add-edit-output-mapping-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.5-add-edit-output-mapping-wso2-300x160.jpg" alt="add edit output mapping wso2" /></a></p>

<h2>Etapa 4 - Testando a filtragem de dados</h2>

<p>Agora vamos abrir a opção " Home > Manage > Services > List > Service
Dashboard > Security for the service > Activate Security > Service Dashboard >
Security for the service", selecionamos a opção "yes" no combo e setamos o
flag "UsernameToken", assim estaremos habilitando segurança por grupo e
usuário do cliente.</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.6-security-for-the-service-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.6-security-for-the-service-wso2-300x130.jpg" alt="security for the service wso2" /></a></p>

<p>Simulando a execução do serviço, no próprio WSO2 Data Services Server, podemos
perceber que aparecem as opções "username" e "password". O retorno será
filtrado de acordo com o usuário que for preenchido nesses campos. Executando
a consulta, notaremos que o campo "SALARIO" só aparece no retorno se
utilizarmos o usuário "Maria".</p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.9-full-return-service-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.9-full-return-service-wso2-300x126.jpg" alt="full return service wso2" /></a></p>

<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.8-parcial-return-service-wso2.jpg"><img src="http://assets.mcorp.com.br/wp-content/uploads/2011/02/figura1.8-parcial-return-service-wso2-300x128.jpg" alt="parcial return service wso2" /></a></p>

<p>Espero ter colaborado, sugestões e criticas são sempre bem vindas, focando o
objetivo de transformar a comunidade <a href="http://www.wso2brasil.com.br/">WSO2 Brasil</a> cada vez mais forte, até o próximo
post.</p>

<p>Post baseado no artigo "<a href="http://wso2.org/library/articles/content-filtering-data-services-user-roles">content filtering data services user roles</a>" de Anjana Fernando - Software Engineer WSO2.</p>

<p>Pode ser visto um exemplo de <a href="http://www.mcorp.com.br/2010/03/consumindo-um-servico-seguro-utilizando-php/">consumo um servico seguro utilizando php</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Consumindo um serviço seguro utilizando PHP]]></title>
    <link href="http://wso2brasil.com.br/blog/2010/03/consumindo-um-servico-seguro-utilizando-php/"/>
    <updated>2010-03-08T20:03:58-03:00</updated>
    <id>http://wso2brasil.com.br/blog/2010/03/consumindo-um-servico-seguro-utilizando-php</id>
    <content type="html"><![CDATA[<p>Dia desses precisei colocar autenticação em um serviço que desenvolvi e
passeando pelas opções da interface administrativa da <a href="http://wso2.org/downloads/esb">WSO2 Enterprise Service
Bus</a> encontrei facilmente minha solução. Um
pouco depois, li no twitter do @<a href="http://twitter.com/wso2">WSO2</a> um comentário
sobre um novo artigo publicado sobre segurança nos <a href="/glossario/#DataServices">Data Services</a>, onde ensinava a fazer toda a parte de
configuração: <a href="http://wso2.org/library/articles/content-filtering-data-services-user-roles">Content Filtering in Data Services with User Roles</a>.</p>

<p>Só que pouco tempo depois de configurar e entregar ao cliente o serviço, veio
o problema: como consumir em <a href="http://www.php.net/">PHP</a> o serviço? No artigo a
solução entregue por eles para consumo é em <a href="http://java.sun.com/">Java</a>, como
a capacidade do cliente deixa a desejar, fiquei de fazer e enviar um exemplo
de consumo do serviço desenvolvido.</p>

<p>Então... mãos na massa!</p>

<h2>Configurando a ESB</h2>

<p>Nesse ponto não irei escrever passo-a-passo a configuração que deve ser feita,
o trabalho realizado pelo pessoal do WSO2 está muito bem feito nessa parte do
artigo: <a href="http://wso2.org/library/articles/content-filtering-data-services-user-roles#step_4">Step 4 – Enable User Authentication for the Data Service</a>.</p>

<h2>Consumo sem segurança</h2>

<p>Um pequeno trecho de PHP que mostra como consumir o serviço sem nenhum tipo de
segurança. Código pequeno, limpo e objetivo.</p>

<p><div><script src='https://gist.github.com/2907833.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907833&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>
</p>

<p>Mas mesmo com toda essa objetividade, o problema do cliente não estava
resolvido e eu recebia o seguinte erro:</p>

<pre><code>ERRO: SOAP header missing
</code></pre>

<p>E, para resolver, faltava adicionar o cabeçalho com os dados de segurança.</p>

<h2>Consumo com segurança</h2>

<p>Agora um não-tão-pequeno trecho em PHP.</p>

<p><div><script src='https://gist.github.com/2907844.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907844&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>
</p>

<p>E tudo rodou normalmente, sem problemas, o cliente ficou feliz e eu matei um
pouco da saudade de programar em PHP.</p>

<p>Na pesquisa por soluções, tentei utilizar o <a href="http://wso2.org/projects/wsf/php">WSO2 Web Services Framework <em>for PHP</em></a> mas descobri que depende de instalação
de módulo no <a href="http://httpd.apache.org">Apache</a> e não servia para meu cliente,
mas anotei na pauta para testá-lo em outro momento.</p>
]]></content>
  </entry>
  
</feed>