
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>WSO2 Enterprise Service Bus - Manipulando erros em Endpoints - WSO2Brasil</title>
  <meta name="author" content="WSO2Brasil">

  
  <meta name="description" content="A manipulação de erros em endpoints é uma situação crítica e importante em
qualquer publicação da WSO2 Enterprise Service Bus. Neste artigo, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wso2brasil.com.br/blog/2010/04/wso2-enterprise-service-bus-manipulando-erros-em-endpoints/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="WSO2Brasil" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.colorbox.min.js" type="text/javascript"></script>
<link href="/stylesheets/colorbox.css" rel="stylesheet" type="text/css">

<script>
jQuery = jQuery.noConflict(true);
jQuery(document).ready( function() {
  var thumbnails = 'a:has(img)[href$=".bmp"],a:has(img)[href$=".gif"],a:has(img)[href$=".jpg"],a:has(img)[href$=".jpeg"],a:has(img)[href$=".png"],a:has(img)[href$=".BMP"],a:has(img)[href$=".GIF"],a:has(img)[href$=".JPG"],a:has(img)[href$=".JPEG"],a:has(img)[href$=".PNG"],a:has(img)[rel^="lightbox"]';
  jQuery(thumbnails).colorbox({
    transition: "none"
  });
});
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39120636-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/"><img src="/images/wso2brasil.png" /></a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com.br/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wso2brasil.com.br" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivos</a></li>
  <li><a href="/sobre">Sobre</a></li>
  <li><a href="/sobre/#contato">Contato</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
  
    <h1 class="entry-title">WSO2 Enterprise Service Bus - Manipulando Erros Em Endpoints</h1>
  



  <p class="meta">
    








  


<time datetime="2010-04-19T11:54:27-03:00" pubdate data-updated="true">Apr 19<span>th</span>, 2010</time>
    
     | <a href="#disqus_thread">Comments</a>
    
  </p>


  </header>


<div class="entry-content"><p>A manipulação de erros em <em>endpoints</em> é uma situação crítica e importante em
qualquer publicação da <a href="http://wso2.org/projects/esb/java">WSO2 Enterprise Service Bus</a>. Neste artigo, <a href="http://wso2.com/about/engineers/supun-kamburugamuva/">SupunKamburugamuva</a> descreveu
como manipular os erros no nível de <em>endpoint</em>.</p>

<p><strong>Nota de tradução:</strong> O artigo original foi escrito em inglês e pode ser lido em: <a href="http://wso2.org/library/articles/wso2-enterprise-service-bus-endpoint-error-handling">WSO2 Enterprise Service Bus - Endpoint Error Handling </a></p>

<h2>WSO2 Enterprise Service Bus - Manipulando erros em <em>endpoints</em></h2>

<h3>Conteúdo</h3>

<ul>
<li><a href="#ManipulandoErrosEndpoint_Terminologia">Terminologia</a></li>
<li><a href="#ManipulandoErrosEndpoint_Introducao">Introdução</a></li>
<li><a href="#ManipulandoErrosEndpoint_Importante">Qual a importância da manipulação de erros?</a></li>
<li><a href="#ManipulandoErrosEndpoint_Conceitos">Conceitos</a></li>
<li><a href="#ManipulandoErrosEndpoint_SituacoesEndpoint">Situações de <em>endpoint</em></a>

<ul>
<li><a href="#ManipulandoErrosEndpoint_SituacoesEndpointActive"><em>Active</em></a></li>
<li><a href="#ManipulandoErrosEndpoint_SituacoesEndpointTimeout"><em>Timeout</em></a></li>
<li><a href="#ManipulandoErrosEndpoint_SituacoesEndpointSuspended"><em>Suspended</em></a></li>
</ul>
</li>
<li><a href="#ManipulandoErrosEndpoint_ConfiguracaoEndpoint">Configurações do <em>Leaf endpoint</em></a>

<ul>
<li><a href="#ManipulandoErrosEndpoint_ConfiguracaoEndpointExemplo">Exemplo de configuração</a></li>
</ul>
</li>
<li><a href="#ManipulandoErrosEndpoint_FailOverEndpoint"><em>Fail-Over Endpoint</em></a>

<ul>
<li><a href="#ManipulandoErrosEndpoint_FailOverEndpointExemplo">Exemplo de configuração</a></li>
</ul>
</li>
<li><a href="#ManipulandoErrosEndpoint_Conclusao">Conclusão</a></li>
<li><a href="#ManipulandoErrosEndpoint_ApendiceA">Apêndice A</a></li>
</ul>


<h3><a name="ManipulandoErrosEndpoint_Terminologia"></a>Terminologia</h3>

<p><em>Service Provider endpoint</em>: WSO2 Enterprise Service Bus atua como uma central
de distribuição, entregando as mensagens recebidas dos clientes aos <em>service
provider endpoints</em>.</p>

<p><em>WSO2 Enterprise Service Bus Endpoint</em>: Esta é a representação do <em>service
provider endpoint</em>, omitida internamente na configuração do WSO2 Enterprise
Service Bus.</p>

<h3><a name="ManipulandoErrosEndpoint_Introducao"></a>Introdução</h3>

<p>Corporações são complexamente estruturadas e compostas por centenas de
aplicações com semânticas completamente diferentes. Algumas dessas aplicações
são desenvolvidas personalizadamente, algumas são adquiridas de terceiros e
outras podem ser a combinação de ambas; e podem ser operadas em diferentes
ambientes e sistemas. Muitas aplicações rodam em diferentes sistemas, o que
faz isso ser muito complexo. E devido a esses fatores, isto é vital a
integração entre as diferentes aplicações.</p>

<p>O WSO2 Enterprise Service Bus tem a capacidade de prover a tecnologia para
integrar essas aplicações, as quais podem ser definidas como o estado da arte
para <a href="http://pt.wikipedia.org/wiki/EAI">EAI</a>, baseadas nos princípios do
<a href="/glossario/#SOA">SOA</a>. Com a WSO2 Enterprise Service Bus, o processo completo
pode ser alcançado pela realização de várias tarefas na mensagem -
transformação (<em>transformation</em>), roteamento (<em>routing</em>) e troca de transporte
(<em>transport switching</em>) - antes do envio ao <em>service provider</em>.</p>

<p>A configuração no WSO2 Enterprise Service Bus é feita em etapas, são elas:</p>

<ul>
<li><em>Mediators</em></li>
<li><em>Proxy services</em></li>
<li><em>Endpoints</em></li>
<li><em>Tasks</em></li>
</ul>


<p>Os<em> Mediators</em> são componentes funcionais dentro do WSO2 Enterprise Service
Bus, eles fazem várias coisas como gravação de log (<em>logging</em>), transformação
(<em>XSLT transformation</em>), envia mensagens externas, filtros baseados em
<em>XPath</em>, etc. Então os <em>mediators</em> são o núcleo da mensagem processada dentro
do WSO2 Enterprise Service Bus. A última etapa da mensagem dentro do WSO2
Enterprise Service Bus é o envio da mensagem de resposta para um <em>services
provider</em>. Quanto ao WSO2 Enterprise Service Bus é responsável pelo envio da
mensagem para um serviço de escuta de <em>endpoint</em>. As mensagens enviadas do
WSO2 Enterprise Service Bus podem ser muito diferentes da mensagem recebida.
Por exemplo, as mensagens recebidas podem ser <em>SOAP 1.1 over HTTP</em>. Mas WSO2
Enterprise Service Bus pode enviar a mensagem para o serviço como <em>SOAP 1.2
over JMS</em>. Neste caso o <em>endpoint</em> exposto para o cliente é <em>SOAP 1.1 over
HTTP</em>, o atual <em>endpoint</em> é <em>SOAP 1.2 over JMS</em>.</p>

<p>Um Endpoint é uma abstração do <em>services provider</em>. Uma vez que a mensagem é
enviada usando um Mediator, ele deve saber qual é o <em>endpoint services
provider</em>. O Endpoint é capaz de prover essa informação. No cenário ideal o
serviço de endpoint aceita requisições de mesmo tipo, WSO2 ESB pode ser usado
para balanceamento de carga (Load Balancer). A principal razão por trás disso
tudo é que esses endpoints tem mesmas funcionalidades e é natural vê-las como
uma coisa só.</p>

<p>WSO2 Enterprise Service Bus tem o conceito de construção de endpoints para
representar <em>endpoint services provider</em>. Seguindo os Endpoints construídos
sobre o WSO2 Enterprise Service Bus.</p>

<ol>
<li>Address Endpoint</li>
<li>WSDL Endpoint</li>
<li>Default Endpoint</li>
<li>Load Balancing Endpoint</li>
<li>Fail-Over Endpoint</li>
</ol>


<p>Dos itens mencionados acima, os mais utilizados são o Address e o WSDL
Endpoints. Cada Endpoint tem seu próprio XML de configuração, escrito na
linguagem Synapse. Synapse é uma linguagem XML usada para configurar a
Enterprise Service Bus.</p>

<p>Até o Endpoint enviar a mensagem de resposta, pode encontrar vários erros de
transporte. Por exemplo, a conexão pode dar timeout ou pode ser fechada pelo
serviço atual.</p>

<h3><a name="ManipulandoErrosEndpoint_Importante"></a>Qual a importância da manipulação de erros?</h3>

<p>WSO2 Enterprise Service Bus é uma aplicação de longa duração e nesse tempo
falhas podem ocorrer. Retiring on transient failures enhances the fault
tolerance of a system. Para a WSO2 Enterprise Service Bus, essas falhas podem
ser falha de conexão entre o <em>services provider</em> e a WSO2 Enterprise Service
bus, erro em alguma operação do banco de dados e assim por diante, sendo que
as falhas de comunicação são mais frequentes.</p>

<p>Então a manipulação de erros é a chave para o sucesso de qualquer publicação
na Enterprise Service Bus. Muitas vezes nós utilizamos TCP, as pessoas podem
perguntar, como podem ocorrem erros? O protocolo TCP é muito confiável, não é?
Mas não na vida real. Mensagens pode falhar ou se perder devido a diversas
razões na rede TCP. Esses erros são muito raros, mas podem ocorrer. Para
entender a importância da manipulação de erros vamos considerar o seguinte
cenário.</p>

<p>Se a WSO2 Enterprise Service Bus não estiver devidamente configurada para
aceitar erros, ocasionalmente, quando eles ocorrerem, o Endpoint será marcado
com uma falha. Isto leva para uma mensagem de falha. Por padrão, o Endpoint
será marcado como falho por um longo tempo. Os erros encontrados na WSO2
Enterprise Service Bus podem ser um problema intermitente que ocorrem uma vez
por semana, mas devido a singularidade do erro, mensagens posteriores poderão
ser perdidas. Claro que você pode configurar a WSO2 Enterprise Service Bus
para manipular estas situações e este artigo dará a você uma maior compreensão
sobre como trabalhar com Endpoints e otimizar as suas configurações.</p>

<h3><a name="ManipulandoErrosEndpoint_Conceitos"></a>Conceitos</h3>

<p>Nós chamamos Address, Default and WSDL Endpoints como Leaf Endpoints, que
enviam a mensagem. A Load Balance ou Fail-Over Endpoints usa um ou vários Leaf
Endpoints para enviar a mensagem. Então um Load Balance ou Fail-Over Endpoint
é um agrupamento lógico de Leaf Endpoints. Um Load Balance ou Fail-Over
Endpoint nunca envia uma mensagem diretamente, ao invés de enviar ela delega
aos Leaf Endpoints, dependendo da configuração e da situação (status).</p>

<p>Endpoint é uma abstração do servidor remoto, onde o WSO2 Enterprise Service
Bus envia a mensagem de saída. Ela pode especificar quais as propriedades
usadas para enviar a mensagem, por exemplo, pode especificar o formato - como
SOAP 1.1 - ou pode especificar a necessidade de utilizar uma política de
segurança com WS Security para responder a mensagem.</p>

<p>WSO2 Enterprise Service Bus Endpoint tem configurações para especificar o
comportamento diante de erros, que podem ocorrer entre a WSO2 Enterprise
Service Bus e o atual Endpoint.</p>

<p>Um Endpoint tem uma situação, mas antes vamos para as configurações de
Endpoint para vermos como as transições acontecem.</p>

<h3><a name="ManipulandoErrosEndpoint_SituacoesEndpoint"></a>Situações do Endpoint</h3>

<p>Em alguns momentos a situação do Endpoint pode ser Active, Timeout, Suspended
ou Off. A situação de transição do Endpoint normalmente acontece na base de
mensagens. E para colocarmos uma situação de Off num Endpoint (utilizando para
issoJMX), então esta situação não é a Situação do Diagrama de Transição. Vamos
analisar as diferentes situações do endpoint em detalhes:</p>

<ul>
<li>Active: O endpoint está ativo e funcionando.</li>
<li>Timeout: Foram encontrados erros no endpoint, que passa a ser um candidato a ser suspenso, mas pode continuar enviando mensagens. Se os erros persisterem o endpoint será suspenso.</li>
<li>Suspended: Foram encontrados erros no endpoint e é enviado para a situação onde não pode enviar requisições. Ele não pode enviar mensagens e mensagens recebidas por ele resultarão em falhas.</li>
<li>Off: O endpoint não está ativo.</li>
</ul>


<p><a href="http://assets.mcorp.com.br/wp-content/uploads/2010/04/state_2.png"><img src="http://assets.mcorp.com.br/wp-content/uploads/2010/04/state_2.png" title="Toda situação de transição acontece na mensagem. Por exemplo, se a duração da suspensão é expirada, na situação Suspended, o endpoint continuará na situação Suspensed até que uma nova mensagem chegue e seja bem sucedida." alt="&quot;Toda situação de transição acontece na mensagem. Por exemplo, se a duração da suspensão é expirada, na situação Suspended, o endpoint continuará na situação Suspensed até que uma nova mensagem chegue e seja bem sucedida.&quot;" /></a></p>

<p>Toda situação de transição acontece na mensagem. Por exemplo, se a duração da
suspensão é expirada, na situação Suspended, o endpoint continuará na situação
Suspensed até que uma nova mensagem chegue e seja bem sucedida.</p>

<h4><a name="ManipulandoErrosEndpoint_SituacoesEndpointActive"></a>Active</h4>

<p>Quando o WSO2 Enterprise Service Bus inicializa, os endpoints estão ativos (na
situação Active) e prontos para enviar mensagens. Se o usuário não desligar os
endpoints (situação Off), será Active até que ocorra um erro.</p>

<p>Quando ocorrer um erro, o Endpoint poderá ser configurado como: Active,
Timeout ou Suspended. Todo erro tem um código. As configurações de Endpoint
possibilitam que você defina os erros que colocarão o Endpoint nos modos
Timeout e Suspension. Se um erro não foi definido como Timeout ou Suspended,
será ignorado.</p>

<p>Os erros são manipulados de três formas:</p>

<ul>
<li>Endpoint na situação SUSPENDED</li>
<li>Endpoint na situação TIMEOUT</li>
<li>Ignorado e mantido no ACTIVE</li>
</ul>


<p>Se um erro específico não possui um <em>timeout</em> configurado, então a conexão
será fechada e o erro será tratado como TIMEOUT. Todos os outros erros terão o
Endpoint colocado como SUSPENDED.</p>

<p>Quando um erro ocorrer no Endpoint, será visto primeiramente se ele é um erro
para colocar na situação TIMEOUT. Caso contrário, será verificado se é para
colocar na situação SUSPENDED.</p>

<h4><a name="ManipulandoErrosEndpoint_SituacoesEndpointTimeout"></a>Timeout</h4>

<p>Nesta situação o Endpoint pode ter na mensagem encaminhada um número máximo de
tentativas. Se as falhas persistirem e o número máximo for excedido, o
Endpoint será marcado como SUSPENDED. Mas se alguma mensagem for processada o
Endpoint será marcado como ACTIVE.</p>

<p>Por exemplo, vamos dizer que o número de tentativas é 3 para esta situção. Se
as próximas três mensagens são enviadas usando este Endpoint, e encontramos um
erro, o endpoint é colocado como SUSPENDED. Mas se alguma das mensagens
anteriores for bem sucedida neste Endpoint, que estava SUSPENDED, ele então
será colocado como ACTIVE.</p>

<h4><a name="ManipulandoErrosEndpoint_SituacoesEndpointSuspended"></a>Suspended</h4>

<p>Um endpoint suspended não pode ser usado para enviar mensagens. Depois que o
endpoint é colocado nesta situação, pode ser tentado novamente após o tempo
configurado. Depois deste de passado o tempo de expiração, o WSO2 Enterprise
Service Bus tentará encaminhar as mensagens deste endpoint. Se a mensagem for
bem-sucedida, então o WSO2 Enterprise Service Bus marcará este endpoint como
ACTIVE. Se a próxima mensagem falhar, o endpoint será colocado como SUSPENDED
ou TIMEOUT dependendo do erro que ocorrer.</p>

<p>O próximo período é calculado usando a seguinte fórmula:</p>

<pre><code>Next suspension time period = Max (Initial Suspension duration * (progression factor try count), Maximum Duration)
</code></pre>

<p>Todas as variáveis da fórmula acima são valores configurados usados para
calcular o número de tentativas (contabilizadas após o endpoint ser marcado
SUSPENDED). Com a incrementação do número de tentativas (try count), o próximo
período de suspensão (next suspension time period) também será incrementado. O
incremento é vinculado a máxima duração (maximum duration).</p>

<h3><a name="ManipulandoErrosEndpoint_ConfiguracaoEndpoint"></a>Configurações do Leaf Endpoint</h3>

<p>Esta é a configuração do endereço do endpoint. Uma vez que estamos
interessados apenas nas configurações de erros, as mesmas também podem ser
aplicadas aos WSDL Endpoints. As configurações de maninpulação de erros são:</p>

<ol>
<li>timeout</li>
<li>markForSuspension</li>
<li>suspendOnFailure</li>
</ol>


<p>Vamos ver as configurações individualmente.</p>

<div><script src='https://gist.github.com/2907143.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907143&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<h4>Timeout</h4>

<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Valores</th>
      <th>Default</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>duration</td>
      <td>miliseconds</td>
      <td>60000</td>
      <td>Tempo máximo de conexão. Se o endpoint remoto não responder neste tempo, ele será tratado como timeout</td>
    </tr>
    <tr>
      <td>action</td>
      <td>discard, fault, none</td>
      <td>none</td>
      <td>Tempo para descartar, invocará uma exceção (fault handler) ou responderá como tempo de execução excedido</td>
    </tr>
  </tbody>
</table>


<h4>markForSuspension</h4>

<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Valores</th>
      <th>Padrão</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>errorCodes</td>
      <td>Códigos de erro separados por vírgula</td>
      <td>101504, 101505</td>
      <td>Lista de erros que envia o endpoint na situação &#8220;TIMEOUT retriesBeforeSuspension&#8221;</td>
    </tr>
    <tr>
      <td>retriesBeforeSuspension</td>
      <td>Integer</td>
      <td>0</td>
      <td>Na situação TIMEOUT o número de tentativas é igual ao número de requisições menos um e pode falhar antes do endpoint ser marcado como &#8220;SUSPENDED retryDelay&#8221;. Esta configuração é por Endpoint e não por mensagem. Muitas mensagens podem ser tentadas ao mesmo tempo e falhar, com isso o número de tentativas restantes será reduzido.</td>
    </tr>
    <tr>
      <td>retryDelay</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>


<h4>suspendOnFailure</h4>

<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Valores</th>
      <th>Padrão</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>errorCodes</td>
      <td>Códigos de erro separados por vírgula</td>
      <td>Todos os erros, exceto os especificados em markForSuspension</td>
      <td>Erros que enviam o endpoint para a situação SUSPENDED</td>
    </tr>
    <tr>
      <td>initialDuration</td>
      <td>miliseconds</td>
      <td>60 x 60 x 1000</td>
      <td>Depois que um endpoint fica SUSPENDED, esperará por essa quantidade de tempo antes de tentar enviar a mensagem. Todas as mensagens que forem recebidas durante este período resultarão na ativação de <em>fault sequence</em>.</td>
    </tr>
    <tr>
      <td>progressionFactor</td>
      <td>Integer</td>
      <td>1</td>
      <td>O endpoint tentará enviar as mensagens depois da <em>initialDuration</em>. Utilizando a fórmula: next duration = Max(initialDuration x progressionFactor ^ retry count, maximumDuration)</td>
    </tr>
    <tr>
      <td>maximunDuration</td>
      <td>miliseconds</td>
      <td>Long.MAX_VALUE</td>
      <td>Limite superior da duração de tentativas</td>
    </tr>
  </tbody>
</table>


<h4><a name="ManipulandoErrosEndpoint_ConfiguracaoEndpointExemplo"></a>Exemplo de configuração</h4>

<div><script src='https://gist.github.com/2907164.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907164&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<p>Aqui nós mudamos a situação TIMEOUT do endpoint para os erros 101504 e 101505.
Depois desse processo, três requisições podem falhar por um ou desses erros
antes de alterar a situação do endpoint para SUSPENDED.</p>

<p>Nós colocamos o endpoint em suspensão para os erros 101500, 101501, 101506,
101507 e 101508. Mas como você pode ver, nós ignoramos o erro 101503. Se o
erro 101503 ocorrer, o endpoint será marcado como ACTIVE.</p>

<p>Para mais informações sobre códigos de erro, ver APÊNDICE A.</p>

<h3><a name="ManipulandoErrosEndpoint_FailOverEndpoint"></a>Fail-Over Endpoint</h3>

<p>Com essa configuração, se ocorrer um erro durante o processo de transmissão da
mensagem, a mesma será perdida. A mensagem que falhou não terá uma nova
tentativa de envio. Esses erros ocorrem raramente, mas falhas em mensagens
ainda podem ocorrer. Em algumas aplicações essas falhas nas mensagens perdidas
são aceitáveis, mas algumas vezes essas falhas não são aceitáveis e o Fail-
Over endpoint é a solução ideal.</p>

<p>Abaixo uma configuração para fail-over endpoints. No nível de configuração, um
fail-over é um agrupamento lógico de um ou mais endpoints.</p>

<div><script src='https://gist.github.com/2907546.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907546&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<p>Quando uma mensagem chega a situação Fail-Over, será atráves da lista de fail-
over endpoints que escolherá a primeira situação entre ACTIVE ou TIMEOUT.
Então será enviada a mensagem usando esse endpoint. Se ocorrer um erro
enquanto a mensagem é enviada, o fail-over, através da lista de endpoints, irá
começar novamente e tentará enviar a mensagem usando o primeiro endpoint.</p>

<p>Alguns erros colocam o endpoint na situação TIMEOUT e outros deixam o endpoint
com a situação ACTIVE. Nesses casos as tentativas acontecem usando o mesmo
endpoint. Se ocorrer um erro com o primeiro endpoint do grupo fail-over e esse
erro não colocar o endpoint como SUSPENDED, as próximas tentativas ocorrerão
usando o mesmo endpoint.</p>

<p>O fail-over dá a prioridade para o primeiro endpoint que não esteja como
SUSPENDED. Então será enviada a mensagem através do primeiro endpoint do grupo
fail-over, enquanto não for marcado como SUSPENDED. Quando o primeiro endpoint
é marcado como SUSPENDED as requisições serão enviadas usando o segundo
endpoint. Quando o primeiro endpoint estiver pronto para ser utilizado
novamente, ele tentará de novo, mesmo que o segundo endpoint ainda esteja
ativo.</p>

<p>Se houver apenas um serviço endpoint e falhas não são toleráveis, os fail-
overs são possíveis com apenas um endpoint.</p>

<p>Abaixo um exemplo de fail-over com um endpoint.</p>

<h4><a name="ManipulandoErrosEndpoint_FailOverEndpointExemplo"></a>Exemplo de configuração de Fail-Over Endpoint</h4>

<div><script src='https://gist.github.com/2907774.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/2907774&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>


<p>Nesse exemplo (Sample_First) o endpoint é marcado como TIMEOUT quando a
conexão excede o tempo máximo de duração, a conexão é fechada ou envia erros
de IO, respectivamente, os códigos de erro: 101504, 101505 e 101500. Para
todos os outros erros, será marcado como SUSPENDED. Quando esse erro ocorrer,
o fail-over tentará usando o primeiro endpoint que não estiver SUSPENDED,
neste caso é o mesmo endpoint (Sample_First). O número de tentativas inicia
com a configuração <em>retriesBeforeSuspension</em> e será reduzida a cada mensagem
que falhar, até chegar ao zero. É importante notar que a configuração da
contagem de tentativas não é por mensagem, mas sim por endpoint.</p>

<p>Nesta configuração nós assumimos que os erros são raros e quando acontecem,
basta tentar novamente. Mas se ocorrem frequentemente e continuamente é
necessário atenção imediata para que voltem para a situação normal.</p>

<h3><a name="ManipulandoErrosEndpoint_Conclusao"></a>Conclusão</h3>

<p>A manipulação de erros é crucial para a publicação de endpoints. Os erros
devem ser descobertos nos testes, é recomendado executar muitos testes de
carga e melhorar a performance das configurações do endpoint preparando-o para
os variados erros que podem ocorrer.</p>

<h3><a name="ManipulandoErrosEndpoint_ApendiceA"></a>Apêndice A</h3>

<table>
  <thead>
    <tr>
      <th>Código</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>101000</td>
      <td>Receiver IO error sending</td>
    </tr>
    <tr>
      <td>101001</td>
      <td>Receiver IO error receiving</td>
    </tr>
    <tr>
      <td>101500</td>
      <td>Sender IO error sending</td>
    </tr>
    <tr>
      <td>101501</td>
      <td>Sender IO error receiving</td>
    </tr>
    <tr>
      <td>101503</td>
      <td>Connection failed</td>
    </tr>
    <tr>
      <td>101504</td>
      <td>Connection timed out</td>
    </tr>
    <tr>
      <td>101505</td>
      <td>Connection closed</td>
    </tr>
    <tr>
      <td>101506</td>
      <td>HTTP protocol violation</td>
    </tr>
    <tr>
      <td>101507</td>
      <td>Connect cancel</td>
    </tr>
    <tr>
      <td>101508</td>
      <td>Connect timeout</td>
    </tr>
    <tr>
      <td>101509</td>
      <td>Send abort</td>
    </tr>
  </tbody>
</table>


<h3>Autor</h3>

<p>Supun Kamburugamuva, Software Engineer, WSO2, supun@wso2.com</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Leonardo Saraiva</span></span>

      








  


<time datetime="2010-04-19T11:54:27-03:00" pubdate data-updated="true">Apr 19<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categorias/desenvolvimento/'>desenvolvimento</a>
  
</span>


      

<span class="tags">
  
    <a class='tag' href='/blog/tags/endpoint/'>endpoint</a>, <a class='tag' href='/blog/tags/enterprise-service-bus/'>enterprise service bus</a>, <a class='tag' href='/blog/tags/erro/'>erro</a>, <a class='tag' href='/blog/tags/esb/'>esb</a>, <a class='tag' href='/blog/tags/fail-over/'>fail-over</a>, <a class='tag' href='/blog/tags/falha/'>falha</a>, <a class='tag' href='/blog/tags/manipulacao/'>manipulação</a>, <a class='tag' href='/blog/tags/wso2/'>wso2</a>
  
</span>

    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://wso2brasil.com.br/blog/2010/04/wso2-enterprise-service-bus-manipulando-erros-em-endpoints/" data-via="wso2brasil" data-counturl="http://wso2brasil.com.br/blog/2010/04/wso2-enterprise-service-bus-manipulando-erros-em-endpoints/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/04/novidades-do-proximo-wso2-data-services-server-2-5-x/" title="Previous Post: Novidades do próximo WSO2 Data Services Server (2.5.x)">&laquo; Novidades do próximo WSO2 Data Services Server (2.5.x)</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/04/instalando-o-wso2-web-services-framework-for-php-2-0-0/" title="Next Post: Instalando o WSO2 Web Services Framework for PHP (2.0.0)">Instalando o WSO2 Web Services Framework for PHP (2.0.0) &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/v-forum-de-tecnologia-em-software-livre/">V Fórum de Tecnologia em Software Livre</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/resenha-soa-aplicado-integrando-com-web-services-e-alem/">Resenha: SOA aplicado: Integrando com web services e além</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/8o-solisc-nos-vemos-la/">8º SoLiSC - Nos vemos lá</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/lancado-wso2-user-engagement-server-1-0-0/">Lançado: WSO2 User Engagement Server - 1.0.0!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/nos-no-fisl-14/">Nós no FISL14</a>
      </li>
    
  </ul>
</section>

<section>
    <h1>Related Posts</h1>
    <ul class="posts">
    
        <li class="related">
        <a href="/blog/2013/03/agendamento-de-tarefas-na-wso2-enterprise-service-bus/">Agendamento de tarefas na WSO2 Enterprise Service Bus</a>
        </li>
    
        <li class="related">
        <a href="/blog/2012/11/treinamento-celepar/">Treinamento: Celepar</a>
        </li>
    
        <li class="related">
        <a href="/blog/2010/10/serie-criando-servicos-com-wso2/">Série criando serviços com WSO2</a>
        </li>
    
        <li class="related">
        <a href="/blog/2010/10/criando-servicos-com-o-wso2-parte-3-wso2-esb/">Criando serviços com o WSO2 - Parte 3 - WSO2 ESB</a>
        </li>
    
        <li class="related">
        <a href="/blog/2010/05/plataforma-wso2/">Plataforma WSO2</a>
        </li>
    
    </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categorias/arquitetura'>arquitetura (9)</a></li><li><a href='/blog/categorias/avisos'>avisos (3)</a></li><li><a href='/blog/categorias/desenvolvimento'>desenvolvimento (29)</a></li><li><a href='/blog/categorias/eventos'>eventos (7)</a></li></ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/tags/data-services' style='font-size: 127.90697674418604%'>data services(20)</a> <a href='/blog/tags/codigo-aberto' style='font-size: 108.37209302325581%'>código aberto(6)</a> <a href='/blog/tags/bam' style='font-size: 105.5813953488372%'>bam(4)</a> <a href='/blog/tags/identity' style='font-size: 105.5813953488372%'>identity(4)</a> <a href='/blog/tags/wso2-carbon' style='font-size: 109.76744186046511%'>wso2 carbon(7)</a> <a href='/blog/tags/instalacao' style='font-size: 104.18604651162791%'>instalação(3)</a> <a href='/blog/tags/oracle' style='font-size: 105.5813953488372%'>oracle(4)</a> <a href='/blog/tags/software-livre' style='font-size: 108.37209302325581%'>software livre(6)</a> <a href='/blog/tags/web-services-application' style='font-size: 104.18604651162791%'>web services application(3)</a> <a href='/blog/tags/enterprise-service-bus' style='font-size: 112.55813953488372%'>enterprise service bus(9)</a> <a href='/blog/tags/esb' style='font-size: 118.13953488372093%'>esb(13)</a> <a href='/blog/tags/dss' style='font-size: 129.30232558139534%'>dss(21)</a> <a href='/blog/tags/eclipse' style='font-size: 106.97674418604652%'>eclipse(5)</a> <a href='/blog/tags/application-server' style='font-size: 106.97674418604652%'>application server(5)</a> <a href='/blog/tags/lancamento' style='font-size: 106.97674418604652%'>lançamento(5)</a> <a href='/blog/tags/wsas' style='font-size: 106.97674418604652%'>wsas(5)</a> <a href='/blog/tags/carbon' style='font-size: 106.97674418604652%'>carbon(5)</a> <a href='/blog/tags/stratos' style='font-size: 104.18604651162791%'>stratos(3)</a> <a href='/blog/tags/wso2' style='font-size: 160.0%'>wso2(43)</a> <a href='/blog/tags/soa' style='font-size: 109.76744186046511%'>soa(7)</a> </span>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("wso2brasil", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/wso2brasil" class="twitter-follow-button" data-show-count="false">Follow @wso2brasil</a>
  
</section>


<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/wso2brasil">@wso2brasil</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'wso2brasil',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - WSO2Brasil -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wso2brasil';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://wso2brasil.com.br/blog/2010/04/wso2-enterprise-service-bus-manipulando-erros-em-endpoints/';
        var disqus_url = 'http://wso2brasil.com.br/blog/2010/04/wso2-enterprise-service-bus-manipulando-erros-em-endpoints/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
